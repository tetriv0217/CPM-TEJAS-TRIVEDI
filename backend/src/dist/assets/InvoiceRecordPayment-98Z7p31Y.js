import{ap as N,aq as A,ai as T,a,ah as e,ar as $,aw as w}from"./index-BxX9oQzF.js";import{a4 as b,ai as g,ak as D,V as I,a2 as P,a1 as E,af as _}from"./IdurarOs-CQjgBJE3.js";import"./index-BpvfEvhx.js";import{a as M,b as k,c as B,E as Y}from"./selectors-BxGMIojk.js";import{e as x}from"./actions-DHZEEjAB.js";import{P as O}from"./index-DHqt5pnV.js";import{s as v}from"./index-KrFx5yLV.js";import{u as q}from"./useDate-DWLKj03u.js";import{P as H,F as W}from"./PaymentForm-D4HKtSd_.js";import{c as C}from"./calculate-BjC4tONc.js";import{t as S}from"./statusTagColor-DxbKI3gy.js";import{T as L}from"./index-If0JhGlO.js";import{D as m}from"./index-C72j0_5_.js";import{C as z}from"./CloseCircleOutlined-Cqac_gmj.js";import"./ErpApp-CWghZTV0.js";import"./index-B2NWdkGn.js";import"./useFetch-BCiAZt0D.js";import"./color-DHucoY0N.js";import"./index-B4EGPytm.js";function G({config:c}){const n=N(),s=b();let{entity:r}=c;const i=A(),{isLoading:u,isSuccess:d,current:o}=T(M),[f]=g.useForm(),[t,j]=a.useState(0);a.useEffect(()=>{if(o){const{credit:l,total:p,discount:y}=o;j(C.sub(C.sub(p,y),l))}},[o]),a.useEffect(()=>{d&&(f.resetFields(),i(x.resetAction({actionType:"recordPayment"})),i(x.list({entity:r})),n(`/${r}/`))},[d]);const h=l=>{if(o){const{_id:p}=o,y=o.client&&o.client._id;l={...l,invoice:p,client:y}}i(x.recordPayment({entity:"payment",jsonData:l}))};return e.jsx(D,{isLoading:u,children:e.jsxs(g,{form:f,layout:"vertical",onFinish:h,children:[e.jsx(H,{maxAmount:t}),e.jsx(g.Item,{children:e.jsx(I,{type:"primary",htmlType:"submit",children:s("Record Payment")})})]})})}function J({config:c,currentItem:n}){var p,y;const s=b(),{entity:r,ENTITY_NAME:i}=c,u=q(),d=N(),[o,f]=a.useState([]),[t,j]=a.useState(n),[h,l]=a.useState({});return a.useEffect(()=>{t!=null&&t.client&&l(t.client[t.client.type])},[t]),a.useEffect(()=>{const F=new AbortController;if(n){const{items:R}=n;f(R),j(n)}return()=>F.abort()},[n]),a.useEffect(()=>{console.info("itemslist",o)},[o]),e.jsxs(e.Fragment,{children:[e.jsx(P,{gutter:[12,12],children:e.jsxs(E,{className:"gutter-row",xs:{span:24},sm:{span:24},md:{span:24},lg:{span:20,push:2},children:[e.jsx(O,{onBack:()=>d(`/${r.toLowerCase()}`),title:`Record Payment for ${i} # ${t.number}/${t.year||""}`,ghost:!1,tags:e.jsx(L,{color:(p=S(t.paymentStatus))==null?void 0:p.color,children:t.paymentStatus&&s(t.paymentStatus)}),extra:[e.jsx(I,{onClick:()=>{d(`/${r.toLowerCase()}`)},icon:e.jsx(z,{}),children:s("Cancel")},`${v.generate()}`),e.jsx(I,{onClick:()=>d(`/invoice/read/${t._id}`),icon:e.jsx(W,{}),children:s("Show Invoice")},`${v.generate()}`)],style:{padding:"20px 0px"}}),e.jsx(_,{dashed:!0})]})}),e.jsxs(P,{gutter:[12,12],children:[e.jsxs(E,{className:"gutter-row",xs:{span:24,order:2},sm:{span:24,order:2},md:{span:10,order:2,push:2},lg:{span:10,order:2,push:4},children:[e.jsx("div",{className:"space50"}),e.jsxs(m,{title:`${s("Client")}  : ${t.client.name}`,column:1,children:[e.jsx(m.Item,{label:s("email"),children:h.email}),e.jsx(m.Item,{label:s("phone"),children:h.phone}),e.jsx(_,{dashed:!0}),e.jsx(m.Item,{label:s("payment status"),children:e.jsx(L,{color:(y=S(t.paymentStatus))==null?void 0:y.color,children:t.paymentStatus&&s(t.paymentStatus)})}),e.jsx(m.Item,{label:s("sub total"),children:u.moneyFormatter({amount:t.subTotal,currency_code:t.currency})}),e.jsx(m.Item,{label:s("total"),children:u.moneyFormatter({amount:t.total,currency_code:t.currency})}),e.jsx(m.Item,{label:s("discount"),children:u.moneyFormatter({amount:t.discount,currency_code:t.currency})}),e.jsx(m.Item,{label:s("Paid"),children:u.moneyFormatter({amount:t.credit,currency_code:t.currency})})]})]}),e.jsx(E,{className:"gutter-row",xs:{span:24,order:1},sm:{span:24,order:1},md:{span:12,order:1},lg:{span:10,order:1,push:2},children:e.jsx(G,{config:c})})]})]})}function K({config:c}){const n=A(),{id:s}=$();let r=T(k(s));a.useEffect(()=>{n(r?x.currentItem({data:r}):x.read({entity:c.entity,id:s}))},[r,s]);const{result:i}=T(B);return r=i,a.useEffect(()=>{n(x.currentAction({actionType:"recordPayment",data:r}))},[r]),e.jsx(Y,{children:r?e.jsx(J,{config:c,currentItem:i}):e.jsx(w,{})})}function ye(){const c="invoice",n=b(),s={PANEL_TITLE:n("invoice"),DATATABLE_TITLE:n("invoice_list"),ADD_NEW_ENTITY:n("add_new_invoice"),ENTITY_NAME:n("invoice"),RECORD_ENTITY:n("record_payment")},r={entity:c,...s};return e.jsx(K,{config:r})}export{ye as default};
