import{ap as $,aq as D,ai as I,a as i,ah as e,ar as U,aw as M}from"./index-Ceshqiaz.js";import{a4 as C,ai as b,ak as k,V as L,a2 as F,a1 as _,af as P,ah as B}from"./IdurarOs-QiO0mqNX.js";import"./index-C8m0D0Z9.js";import{d as R,s as v,E as S}from"./selectors-DzM9jS4k.js";import{e as h}from"./actions-CqH49u7k.js";import{d as Y,P as O}from"./index-BauFKgOT.js";import{s as N}from"./index-KrFx5yLV.js";import{u as q}from"./useDate-DhPwrpth.js";import{c as g}from"./calculate-Dn_E62tH.js";import{P as H,F as V}from"./PaymentForm-B_0RNzet.js";import{t as w}from"./statusTagColor-DxbKI3gy.js";import{T as A}from"./index-Y7wTz0MG.js";import{D as l}from"./index-Zmv62RlB.js";import{C as W}from"./CloseCircleOutlined-C9A4eADL.js";import"./ErpApp-HOQT9QP8.js";import"./index-DEN0yfq5.js";import"./useFetch-zry2Bn3b.js";import"./color-DHucoY0N.js";import"./index-Hbyzj37N.js";function z({config:n,currentInvoice:s}){const a=C(),o=$();let{entity:m}=n;const r=D(),{isLoading:u,isSuccess:t}=I(R),[p]=b.useForm(),[j,T]=i.useState(0);i.useEffect(()=>{if(s){const{credit:c,total:x,discount:y,amount:E}=s;T(g.sub(g.sub(x,y),g.sub(g.sub(c,E))));const d={...s};d.date&&(d.date=Y(d.date)),p.setFieldsValue(d)}},[s]),i.useEffect(()=>{t&&(p.resetFields(),r(h.resetAction({actionType:"recordPayment"})),r(h.list({entity:m})),o(`/${m.toLowerCase()}/read/${s._id}`))},[t]);const f=c=>{if(s){const{_id:x}=s,y=s.client&&s.client._id;c={...c,invoice:x,client:y}}r(h.update({entity:m,id:s._id,jsonData:c}))};return e.jsx(e.Fragment,{children:e.jsx(k,{isLoading:u,children:e.jsxs(b,{form:p,layout:"vertical",onFinish:f,children:[e.jsx(H,{maxAmount:j}),e.jsx(b.Item,{children:e.jsx(L,{type:"primary",htmlType:"submit",children:a("Update")})})]})})})}function G({config:n,currentItem:s}){var f,c;const a=C(),{entity:o,ENTITY_NAME:m}=n,r=q(),u=$(),[t,p]=i.useState(s);i.useEffect(()=>{const x=new AbortController;if(s){const{invoice:y,_id:E,...d}=s;p({...d,...y,_id:E})}return()=>x.abort()},[s]);const[j,T]=i.useState({});return i.useEffect(()=>{t!=null&&t.client&&T(t.client[t.client.type])},[t]),e.jsxs(e.Fragment,{children:[e.jsx(F,{gutter:[12,12],children:e.jsxs(_,{className:"gutter-row",xs:{span:24},sm:{span:24},md:{span:24},lg:{span:20,push:2},children:[e.jsx(O,{onBack:()=>u(`/${o.toLowerCase()}`),title:`Update  ${m} # ${t.number}/${t.year||""}`,ghost:!1,tags:e.jsx(A,{color:(f=w(t.paymentStatus))==null?void 0:f.color,children:t.paymentStatus}),extra:[e.jsx(L,{onClick:()=>{u(`/${o.toLowerCase()}`)},icon:e.jsx(W,{}),children:a("Cancel")},`${N.generate()}`),e.jsx(L,{onClick:()=>u(`/invoice/read/${t._id}`),icon:e.jsx(V,{}),children:a("Show invoice")},`${N.generate()}`)],style:{padding:"20px 0px"}}),e.jsx(P,{dashed:!0})]})}),e.jsxs(F,{gutter:[12,12],children:[e.jsxs(_,{className:"gutter-row",xs:{span:24,order:2},sm:{span:24,order:2},md:{span:10,order:2,push:2},lg:{span:10,order:2,push:4},children:[e.jsx("div",{className:"space50"}),e.jsxs(l,{title:`${a("Client")} : ${t.client.name}`,column:1,children:[e.jsx(l.Item,{label:a("email"),children:j.email}),e.jsx(l.Item,{label:a("Phone"),children:j.phone}),e.jsx(P,{dashed:!0}),e.jsx(l.Item,{label:a("Payment Status"),children:e.jsx(A,{color:(c=w(t.paymentStatus))==null?void 0:c.color,children:t.paymentStatus})}),e.jsx(l.Item,{label:a("SubTotal"),children:r.moneyFormatter({amount:t.subTotal,currency_code:t.currency})}),e.jsx(l.Item,{label:a("Total"),children:r.moneyFormatter({amount:t.total,currency_code:t.currency})}),e.jsx(l.Item,{label:"Discount",children:r.moneyFormatter({amount:t.discount,currency_code:t.currency})}),e.jsx(l.Item,{label:"Balance",children:r.moneyFormatter({amount:t.credit,currency_code:t.currency})})]})]}),e.jsx(_,{className:"gutter-row",xs:{span:24,order:1},sm:{span:24,order:1},md:{span:12,order:1},lg:{span:10,order:1,push:2},children:e.jsx(z,{config:n,currentInvoice:t})})]})]})}function J({config:n}){const s=D(),{id:a}=U();i.useLayoutEffect(()=>{s(h.read({entity:n.entity,id:a}))},[a]);const{result:o,isSuccess:m,isLoading:r=!0}=I(v);return i.useLayoutEffect(()=>{o&&s(h.currentAction({actionType:"update",id:a,data:o}))},[o]),r?e.jsx(S,{children:e.jsx(M,{})}):e.jsx(S,{children:m?e.jsx(G,{config:n,currentItem:o}):e.jsx(B,{entity:n.entity})})}function ye(){const n=C(),s="payment",a={PANEL_TITLE:n("payment"),DATATABLE_TITLE:n("payment_list"),ADD_NEW_ENTITY:n("add_new_payment"),ENTITY_NAME:n("payment")},o={entity:s,...a};return e.jsx(J,{config:o})}export{ye as default};
